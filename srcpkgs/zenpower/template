# Template file for 'zenpower'
pkgname=zenpower
version=0.1.12
revision=1
depends="dkms"
short_desc="Kernel driver for AMD Zen CPU temperature/power stats"
maintainer="Antonio Gurgel <antonio@goorzhel.com>"
license="GPL-2.0-only"
homepage="https://github.com/ocerman/zenpower"
distfiles="https://github.com/ocerman/zenpower/archive/v${version}.tar.gz"
checksum=fd25dffbc0f0139e167aa8adecc61ce200f0395c6778302e236b4043f125e77d

dkms_modules="${pkgname} ${version}"

do_install() {
	local _dkms_root=usr/src/${pkgname}-${version}
	vmkdir $_dkms_root
	vcopy dkms.conf $_dkms_root
	vcopy Makefile $_dkms_root
	vcopy zenpower.c $_dkms_root
	vdoc README.md

	sed -i -e "s/@CFLGS@/${XBPS_CFLAGS}/" ${PKGDESTDIR}/$_dkms_root/dkms.conf
	sed -i -e "s/@VERSION@/${version}/" ${PKGDESTDIR}/$_dkms_root/dkms.conf

	vinstall ${FILESDIR}/blacklist-k10temp.conf 644 usr/lib/modprobe.d
}
